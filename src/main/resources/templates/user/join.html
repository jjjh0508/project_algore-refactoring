<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>알고레</title>
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&family=Yeon+Sung&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}"/>




    <style>
        a {
            text-decoration: none
        }

        .sear-btn {
            font-family: Inter;
            font-size: 20px;
            letter-spacing: 0;
            font-weight: bold;
            color: #208BCE;
        }

        .new-margin {
            margin-top: 30px;
        }

        .fon-color {
            color: #085A84;
        }

        .but-off-color {
            background-color: #D8F0FF;
            /*버튼테두리*/
            border-color: #D8F0FF;
            /*버튼*/
            color: #085A84;
            /*텍스트*/
            padding: 10px 15px 10px 15px;
            border-radius: 2em;
        }

        .but-off-color:hover {
            background-color: #99D3F8;
            /*버튼테두리*/
            border-color: #99D3F8;
            /*버튼*/
            color: #085A84;
            /*텍스트*/
            padding: 10px 15px 10px 15px;
            border-radius: 2em;
        }

        .input-box-sty {
            margin-top: 10px;
            border: 2px solid;
            border-color: #085A8430;
            font-size: 15px;
        }

        .pla-col::placeholder {
            color: #085A8485;
            font-size: 15px;
        }





    </style>



</head>
<body>
<!--13_0_회원가입-->
<main class="write01"
      style="width: 1000px; margin: 0 auto; padding-left:10px; padding-right: 10px; margin-bottom: 100px; margin-top: 120px;">
    <div class="text-center">
        <div class="form-signin mx-auto" style="width: 400px;">
            <form action="/user/regist" method="post" enctype="application/x-www-form-urlencoded"accept-charset="UTF-8">
                <!--회원가입-->
                <h1 class="h1 mb-5 fw-bold" style="color: #208BCE;">회원가입</h1>
                <!--이름 입력 영역-->
                <div class="form-floating">
                    <input type="text" class="form-control" id="name" name="name" placeholder="id" required oninvalid="this.setCustomValidity('이름을 입력 해주세요')">
                    <label for="username">이름</label>
                </div>
                <!--아이디 입력 영역-->
                <div class="d-flex justify-content-start" style="margin-top: 15px;">
                    <table>
                        <td>
                            <!--아이디 입력-->
                            <div class="form-floating">
                                <input type="text" class="form-control" id="username" name="username"
                                       placeholder="id" value = ""  style="width: 260px;"required oninvalid="this.setCustomValidity('아이디를 입력해주세요 ')">
                                <label for="username">아이디</label>
                            </div>
                        </td>
                        <td>
                            <!--아이디 중복 확인-->
                            <div id="CId">

                                <button  type="button" id="butWithFun" class="btn btn-info but-off-color"
                                        style="width: 100px; height: 55px;">중복</button>


                            </div>

                        </td>
                    </table>
                </div>
                <!--(자바스크립트로) 아이디 중복 확인 알림...-->
                <div class="d-flex justify-content-start" id="CheckId" style="margin-top: 5px;">
                    <label style="float: left;"></label>
                </div>
                <!--닉네임 입력 영역-->
                <div class="d-flex justify-content-start" style="margin-top: 15px;">
                    <table>
                        <td>
                            <!--닉네임 입력-->
                            <div class="form-floating">
                                <input type="text" class="form-control"  name="nickName"
                                       placeholder="id" style="width: 260px;">
                                <label >닉네임</label>
                            </div>
                        </td>

                    </table>
                </div>
                <!--(자바스크립트로) 닉네임 중복 확인 알림...-->

                <!--비밀번호 입력 영역-->
                <div class="form-floating" style="margin-top: 15px;">
                    <input type="text" class="form-control" id="password" name="password" placeholder="id" required oninvalid="this.setCustomValidity('비밀번호를 입력 해주세요')">
                    <label for="username">비밀번호</label>
                </div>
                <!--생년월일 입력 영역-->
                <div class="form-floating" style="margin-top: 15px;">
                    <input type="date" class="form-control" id="birth" name="birth" placeholder="id" required oninvalid="this.setCustomValidity('생년월일을 입력 해주세요')">
                    <label for="username">생년월일</label>
                </div>
                <!--이메일 입력 영역-->
                <div class="d-flex justify-content-start" style="margin-top: 15px;">
                    <table>
                        <td>
                            <!--이메일 입력-->
                            <div class="form-floating">
                                <input type="email" class="form-control" id="email" name="email"
                                       placeholder="id" style="width: 260px;" >
                                <label >이메일</label>
                            </div>
                        </td>
                        <td>
                            <!--이메일 인증-->
                            <div class="checkId">
                                <button type="button" id="emailCheck" class="btn btn-info but-off-color"
                                        style="width: 150px; height: 55px;">인증코드 전송
                                </button>
                            </div>
                        </td>

                    </table>
                </div>
                <div class="d-flex justify-content-start" id="clickEmail" style="margin-top: 5px;">
                    <label style="float: left;"></label>
                </div>
                <div class="d-flex justify-content-start" style="margin-top: 15px;">
                    <table>
                        <td>
<!--                            코드 입력-->
                            <div class="form-floating">
                                <input type="text"  class="form-control" id="code" name="code"
                                       placeholder="id" style="width: 260px;" required>
                                <label for="">인증코드</label>
                            </div>
                        </td>
                        <td>
                            <!--코드 인증-->
                            <div class="checkId">
                                <button type="button"  disabled id="codeCheck" class="btn btn-info but-off-color"
                                        style="width: 150px; height: 55px;">인증확인
                                </button>
                            </div>
                        </td>

                    </table>
                </div>
                <!--(자바스크립트로) 닉네임 중복 확인 알림...-->
                <div class="d-flex justify-content-start" style="margin-top: 5px;">
<!--                    <label for="alim" style="float: left;">*해당 이메일로 인증코드를 발송하였습니다.</label>-->
                </div>
                <!--버튼-->
                <div class="d-flex justify-content-center" style="margin-top: 50px;">
                    <!--이전 버튼-->
                    <button class="btn btn-lg btn-primary but-off-color" type="button"
                            style="margin-right: 20px;"><b>이전</b></button>
                    <!--회원가입 버튼-->
                    <button type="submit"  disabled id="joinbtn"  class="btn btn-lg btn-primary but-off-color joinbtn">
                        <b>회원가입</b>
                    </button>
                    <!--                    <button class="btn btn-lg btn-primary but-off-color" type="submit"><b>회원가입</b></button>-->
                </div>
            </form>
        </div>
    </div>
</main>
</body>
</html>
<script th:inline="javascript">
    let message = [[${message}]];

    if (message != null && message !== '') {
        alert(message);
    }




    let button = document.querySelector("#joinbtn");
    let chbutton = document.querySelector("#codeCheck");
    let findId = document.getElementById("CheckId");
    let findCode = document.getElementById("clickEmail");
    let emailCode = $("#CheckCode").val();
    let joindate =0;
    let emailCodeVar = 0;
    document.getElementById('butWithFun').addEventListener('click',function(){
        var username = $("#username").val();
        if(username.length == 0 ){
            alert('아이디를 입력해주세요')
            console.log("확인")
            return
        }

        let memId = fetch("http://localhost:8080/findId?username="+username ,{ method: "GET"}
        ).then(res => res.text())
            .then(data => find(data))
            .catch(err => console.log(err));
    })



    function find(data){
        joindate =data;
        console.log(data)
        console.log(joindate)
        if (data==1){
            findId.innerHTML= "<div>"+"사용 할 수 있는 아이디 입니다."+"</div>";
        }else {
            findId.innerHTML= "<div>"+"사용 할 수 없는 아이디 입니다."+"</div>";
            button.disabled = true;
        }


    }


    document.getElementById('emailCheck').addEventListener('click',function(){

        var  email = $("#email").val();
        if(email.length==0){
            alert('이메일을 입력해주세요');
            return;
        }
        findCode.innerHTML ="<div>"+"인증코드를 발송했습니다."+"</div>";
        chbutton.disabled=false;
        let emailcheck = fetch("http://localhost:8080/mailConfirm",{headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'},
            method: "POST", body:JSON.stringify({email : email})
        }).then(res => res.text())
            .then(code => checkEmailCode(code))
            .catch(err => console.log(err));

        emailCodeVar= code;
    })

    function checkEmailCode(code){
        emailCodeVar = code;
        console.log(code);
    }

    document.getElementById('codeCheck').addEventListener('click',function(){
        var code = $("#code").val();
        console.log(code);
        console.log(emailCodeVar);
        if(code===emailCodeVar){
            let emCode = document.querySelector("#code");
            // let emaliText = document.querySelector("#emails");

            alert("인증 성공")
            emCode.disabled=true;
            // emaliText.disabled=true;
            if (joindate==1){

                button.disabled = false;
            }


        }


    })

</script>